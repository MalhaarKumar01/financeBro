<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINANCEBRO // VALUATION TERMINAL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Bebas+Neue&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">FINANCE<span>BRO</span></div>
            <div class="subtitle">Valuation Terminal // P/E & PEG Analysis</div>
            <div class="timestamp" id="timestamp">LOADING...</div>
        </header>

        <div class="main-grid">
            <!-- Exchange Tabs -->
            <div class="exchange-tabs">
                <button class="tab-btn active" data-exchange="nyse">
                    <span class="tab-label">NYSE</span>
                    <span class="tab-flag">ðŸ‡ºðŸ‡¸</span>
                    <span class="tab-count">10 STOCKS</span>
                </button>
                <button class="tab-btn" data-exchange="tsx">
                    <span class="tab-label">TSX</span>
                    <span class="tab-flag">ðŸ‡¨ðŸ‡¦</span>
                    <span class="tab-count">10 STOCKS</span>
                </button>
                <button class="tab-btn" data-exchange="hkex">
                    <span class="tab-label">HKEX</span>
                    <span class="tab-flag">ðŸ‡­ðŸ‡°</span>
                    <span class="tab-count">10 STOCKS</span>
                </button>
                <button class="tab-btn" data-exchange="sgx">
                    <span class="tab-label">SGX</span>
                    <span class="tab-flag">ðŸ‡¸ðŸ‡¬</span>
                    <span class="tab-count">10 STOCKS</span>
                </button>
                <button class="tab-btn" data-exchange="nse">
                    <span class="tab-label">NSE</span>
                    <span class="tab-flag">ðŸ‡®ðŸ‡³</span>
                    <span class="tab-count">10 STOCKS</span>
                </button>
                <div class="tab-info">
                    <span id="current-exchange">NYSE</span> // <span id="stock-count">10</span> SECURITIES LOADED
                </div>
            </div>

            <!-- Power Search Bar -->
            <div class="power-search-container">
                <div class="search-bar">
                    <div class="search-input-wrapper">
                        <span class="search-prefix">></span>
                        <input type="text" id="stock-search" placeholder="SEARCH: ticker:AAPL | pe<20 | peg>1 | industry:Tech | sort:pe">
                        <span class="search-shortcut">CTRL+K</span>
                    </div>
                    <div class="filter-btns">
                        <button class="filter-btn active" data-filter="all">ALL</button>
                        <button class="filter-btn" data-filter="undervalued">UNDERVALUED</button>
                        <button class="filter-btn" data-filter="fair">FAIR</button>
                        <button class="filter-btn" data-filter="overvalued">OVERVALUED</button>
                    </div>
                </div>
                <div class="sort-controls">
                    <span class="sort-label">SORT:</span>
                    <button class="sort-btn active" data-sort="ticker">TICKER</button>
                    <button class="sort-btn" data-sort="pe-asc">P/E â†‘</button>
                    <button class="sort-btn" data-sort="pe-desc">P/E â†“</button>
                    <button class="sort-btn" data-sort="peg-asc">PEG â†‘</button>
                    <button class="sort-btn" data-sort="peg-desc">PEG â†“</button>
                    <button class="sort-btn" data-sort="price-asc">PRICE â†‘</button>
                    <button class="sort-btn" data-sort="price-desc">PRICE â†“</button>
                    <button class="sort-btn" data-sort="change-desc">CHANGE â†“</button>
                    <span class="index-display" id="index-display">IDX: 001-010</span>
                </div>
                <div class="search-help">
                    <span class="help-tag">SYNTAX:</span>
                    <code>ticker:XYZ</code>
                    <code>pe&lt;20</code>
                    <code>pe&gt;10</code>
                    <code>peg&lt;1</code>
                    <code>growth&gt;15</code>
                    <code>industry:Tech</code>
                </div>
            </div>

            <!-- Industry Filter -->
            <div class="industry-bar">
                <div class="industry-label">SECTOR:</div>
                <div class="industry-btns" id="industry-btns">
                    <button class="industry-btn active" data-industry="all">ALL</button>
                    <button class="industry-btn" data-industry="Technology">TECH</button>
                    <button class="industry-btn" data-industry="Defence">DEFENCE</button>
                    <button class="industry-btn" data-industry="Financials">FINANCIALS</button>
                    <button class="industry-btn" data-industry="Healthcare">HEALTHCARE</button>
                    <button class="industry-btn" data-industry="Energy">ENERGY</button>
                    <button class="industry-btn" data-industry="Industrials">INDUSTRIALS</button>
                    <button class="industry-btn" data-industry="Consumer Cyclical">CONSUMER</button>
                    <button class="industry-btn" data-industry="Consumer Defensive">STAPLES</button>
                    <button class="industry-btn" data-industry="Materials">MATERIALS</button>
                    <button class="industry-btn" data-industry="Utilities">UTILITIES</button>
                    <button class="industry-btn" data-industry="Telecom">TELECOM</button>
                    <button class="industry-btn" data-industry="Real Estate">REAL ESTATE</button>
                </div>
            </div>

            <div class="section-header">
                <h2>STOCK VALUATIONS</h2>
            </div>

            <!-- Stock Grid Container -->
            <div class="stock-grid" id="stock-grid">
                <!-- Stocks will be rendered here by JavaScript -->
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- Pagination buttons rendered by JS -->
            </div>

            <!-- Terminal Footer -->
            <div class="terminal-footer">
                <div class="terminal-line">System initialized: <span>FINANCEBRO v4.0 // GLOBAL EDITION</span></div>
                <div class="terminal-line">Data sources: <span>NYSE, TSX, HKEX, SGX, NSE // 5 EXCHANGES</span></div>
                <div class="terminal-line">Analysis complete: <span id="stats-line">50 stocks processed // 250 metrics evaluated</span></div>
                <div class="terminal-line">Keyboard: <span>CTRL+K search | CTRL+1-5 exchange | ESC clear</span></div>
                <div class="terminal-line">Status: <span class="status-ready">READY FOR ANALYSIS</span></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // STOCK DATA - 5 GLOBAL EXCHANGES (10 STOCKS EACH)
        // ============================================
        const stockData = {
            // NYSE - USA (10 stocks)
            nyse: [
                { ticker: 'JPM', name: 'JPMorgan Chase', price: 195.42, change: 1.12, pe: 11.80, forwardPe: 10.50, peg: 0.92, growth: 12.8, industry: 'Financials', industryPe: 12.5 },
                { ticker: 'V', name: 'Visa Inc.', price: 279.85, change: 0.92, pe: 30.45, forwardPe: 25.80, peg: 1.89, growth: 16.1, industry: 'Financials', industryPe: 12.5 },
                { ticker: 'JNJ', name: 'Johnson & Johnson', price: 156.78, change: 0.23, pe: 15.20, forwardPe: 14.50, peg: 2.45, growth: 6.2, industry: 'Healthcare', industryPe: 22.0 },
                { ticker: 'XOM', name: 'Exxon Mobil', price: 104.55, change: 0.67, pe: 12.30, forwardPe: 11.80, peg: 0.95, growth: 12.9, industry: 'Energy', industryPe: 10.5 },
                { ticker: 'PG', name: 'Procter & Gamble', price: 159.45, change: 0.34, pe: 26.80, forwardPe: 24.10, peg: 3.85, growth: 7.0, industry: 'Consumer Defensive', industryPe: 24.0 },
                { ticker: 'HD', name: 'Home Depot', price: 348.90, change: 1.23, pe: 23.40, forwardPe: 21.50, peg: 2.08, growth: 11.3, industry: 'Consumer Cyclical', industryPe: 22.0 },
                { ticker: 'CVX', name: 'Chevron Corp.', price: 149.80, change: 0.56, pe: 11.90, forwardPe: 11.20, peg: 0.88, growth: 13.5, industry: 'Energy', industryPe: 10.5 },
                { ticker: 'MRK', name: 'Merck & Co.', price: 108.25, change: -0.45, pe: 18.70, forwardPe: 13.20, peg: 1.35, growth: 13.9, industry: 'Healthcare', industryPe: 22.0 },
                { ticker: 'KO', name: 'Coca-Cola Co.', price: 59.85, change: 0.12, pe: 23.80, forwardPe: 21.50, peg: 3.40, growth: 7.0, industry: 'Consumer Defensive', industryPe: 24.0 },
                { ticker: 'DIS', name: 'Walt Disney Co.', price: 112.45, change: -0.89, pe: 72.50, forwardPe: 24.80, peg: 1.45, growth: 50.0, industry: 'Consumer Cyclical', industryPe: 22.0 }
            ],
            // TSX - Canada (10 stocks)
            tsx: [
                { ticker: 'RY', name: 'Royal Bank of Canada', price: 135.42, change: 0.89, pe: 12.80, forwardPe: 11.50, peg: 1.28, growth: 10.0, industry: 'Financials', industryPe: 11.5 },
                { ticker: 'TD', name: 'Toronto-Dominion Bank', price: 82.15, change: 0.45, pe: 11.20, forwardPe: 10.30, peg: 1.40, growth: 8.0, industry: 'Financials', industryPe: 11.5 },
                { ticker: 'ENB', name: 'Enbridge Inc.', price: 48.90, change: 0.23, pe: 18.50, forwardPe: 16.80, peg: 2.31, growth: 8.0, industry: 'Energy', industryPe: 12.0 },
                { ticker: 'CNR', name: 'Canadian National Railway', price: 165.80, change: 1.23, pe: 22.40, forwardPe: 19.80, peg: 2.24, growth: 10.0, industry: 'Industrials', industryPe: 18.5 },
                { ticker: 'BNS', name: 'Bank of Nova Scotia', price: 65.45, change: 0.34, pe: 10.80, forwardPe: 9.90, peg: 0.85, growth: 12.7, industry: 'Financials', industryPe: 11.5 },
                { ticker: 'SU', name: 'Suncor Energy', price: 45.80, change: 0.67, pe: 8.90, forwardPe: 8.20, peg: 0.74, growth: 12.0, industry: 'Energy', industryPe: 12.0 },
                { ticker: 'BMO', name: 'Bank of Montreal', price: 125.30, change: 0.56, pe: 12.40, forwardPe: 10.80, peg: 1.24, growth: 10.0, industry: 'Financials', industryPe: 11.5 },
                { ticker: 'ABX', name: 'Barrick Gold', price: 22.15, change: 0.34, pe: 18.90, forwardPe: 14.50, peg: 0.95, growth: 19.9, industry: 'Materials', industryPe: 15.0 },
                { ticker: 'CSU', name: 'Constellation Software', price: 3245.00, change: 45.00, pe: 95.80, forwardPe: 72.30, peg: 3.19, growth: 30.0, industry: 'Technology', industryPe: 32.0 },
                { ticker: 'SHOP', name: 'Shopify Inc.', price: 89.50, change: 2.34, pe: 85.20, forwardPe: 52.30, peg: 0.95, growth: 89.7, industry: 'Technology', industryPe: 32.0 }
            ],
            // HKEX - Hong Kong (10 stocks)
            hkex: [
                { ticker: '0700', name: 'Tencent Holdings', price: 368.40, change: 2.15, pe: 22.50, forwardPe: 18.90, peg: 0.85, growth: 26.5, industry: 'Technology', industryPe: 25.0 },
                { ticker: '9988', name: 'Alibaba Group', price: 88.25, change: 1.45, pe: 18.90, forwardPe: 12.50, peg: 0.72, growth: 26.3, industry: 'Technology', industryPe: 25.0 },
                { ticker: '1299', name: 'AIA Group', price: 68.90, change: 0.78, pe: 15.80, forwardPe: 13.20, peg: 1.32, growth: 12.0, industry: 'Financials', industryPe: 14.0 },
                { ticker: '0005', name: 'HSBC Holdings', price: 62.45, change: 0.34, pe: 7.80, forwardPe: 7.20, peg: 0.65, growth: 12.0, industry: 'Financials', industryPe: 14.0 },
                { ticker: '0941', name: 'China Mobile', price: 72.80, change: 0.23, pe: 9.50, forwardPe: 8.80, peg: 1.58, growth: 6.0, industry: 'Telecom', industryPe: 12.0 },
                { ticker: '2318', name: 'Ping An Insurance', price: 45.60, change: -0.45, pe: 8.20, forwardPe: 7.50, peg: 0.68, growth: 12.1, industry: 'Financials', industryPe: 14.0 },
                { ticker: '3690', name: 'Meituan', price: 128.50, change: 3.21, pe: 45.80, forwardPe: 28.90, peg: 1.15, growth: 39.8, industry: 'Technology', industryPe: 25.0 },
                { ticker: '1810', name: 'Xiaomi Corp.', price: 18.92, change: 1.56, pe: 28.40, forwardPe: 22.10, peg: 0.95, growth: 29.9, industry: 'Technology', industryPe: 25.0 },
                { ticker: '0939', name: 'China Construction Bank', price: 5.42, change: 0.12, pe: 4.50, forwardPe: 4.20, peg: 0.75, growth: 6.0, industry: 'Financials', industryPe: 14.0 },
                { ticker: '0883', name: 'CNOOC Ltd.', price: 15.80, change: 0.45, pe: 6.80, forwardPe: 6.20, peg: 0.57, growth: 11.9, industry: 'Energy', industryPe: 10.0 }
            ],
            // SGX - Singapore (10 stocks)
            sgx: [
                { ticker: 'D05', name: 'DBS Group Holdings', price: 35.80, change: 0.67, pe: 10.20, forwardPe: 9.50, peg: 0.85, growth: 12.0, industry: 'Financials', industryPe: 11.0 },
                { ticker: 'O39', name: 'OCBC Bank', price: 13.45, change: 0.23, pe: 9.80, forwardPe: 9.20, peg: 0.98, growth: 10.0, industry: 'Financials', industryPe: 11.0 },
                { ticker: 'U11', name: 'United Overseas Bank', price: 30.20, change: 0.45, pe: 10.50, forwardPe: 9.80, peg: 1.05, growth: 10.0, industry: 'Financials', industryPe: 11.0 },
                { ticker: 'Z74', name: 'Singtel', price: 2.85, change: 0.02, pe: 22.40, forwardPe: 18.50, peg: 2.80, growth: 8.0, industry: 'Telecom', industryPe: 15.0 },
                { ticker: 'C38U', name: 'CapitaLand Integrated', price: 2.12, change: 0.03, pe: 18.90, forwardPe: 16.80, peg: 1.89, growth: 10.0, industry: 'Real Estate', industryPe: 18.0 },
                { ticker: 'BN4', name: 'Keppel Corp.', price: 7.25, change: 0.12, pe: 12.80, forwardPe: 11.20, peg: 1.07, growth: 12.0, industry: 'Industrials', industryPe: 15.0 },
                { ticker: 'S68', name: 'Singapore Exchange', price: 10.85, change: 0.18, pe: 24.50, forwardPe: 22.30, peg: 2.45, growth: 10.0, industry: 'Financials', industryPe: 11.0 },
                { ticker: 'C52', name: 'ComfortDelGro', price: 1.42, change: 0.01, pe: 18.20, forwardPe: 15.80, peg: 1.82, growth: 10.0, industry: 'Industrials', industryPe: 15.0 },
                { ticker: 'V03', name: 'Venture Corp.', price: 14.20, change: 0.25, pe: 15.80, forwardPe: 14.20, peg: 1.32, growth: 12.0, industry: 'Technology', industryPe: 20.0 },
                { ticker: 'S58', name: 'SATS Ltd.', price: 2.95, change: 0.08, pe: 35.80, forwardPe: 22.40, peg: 0.89, growth: 40.2, industry: 'Industrials', industryPe: 15.0 }
            ],
            // NSE - India (10 stocks)
            nse: [
                { ticker: 'RELIANCE', name: 'Reliance Industries', price: 2485.60, change: 1.23, pe: 28.50, forwardPe: 24.20, peg: 1.42, growth: 20.1, industry: 'Energy', industryPe: 15.0 },
                { ticker: 'TCS', name: 'Tata Consultancy', price: 3842.50, change: 0.89, pe: 32.40, forwardPe: 28.50, peg: 2.16, growth: 15.0, industry: 'Technology', industryPe: 28.0 },
                { ticker: 'HDFCBANK', name: 'HDFC Bank', price: 1625.80, change: 0.45, pe: 19.80, forwardPe: 17.20, peg: 1.32, growth: 15.0, industry: 'Financials', industryPe: 18.0 },
                { ticker: 'INFY', name: 'Infosys Ltd.', price: 1542.30, change: 0.67, pe: 28.90, forwardPe: 24.50, peg: 1.93, growth: 15.0, industry: 'Technology', industryPe: 28.0 },
                { ticker: 'ICICIBANK', name: 'ICICI Bank', price: 1085.40, change: 1.12, pe: 18.50, forwardPe: 16.20, peg: 0.92, growth: 20.1, industry: 'Financials', industryPe: 18.0 },
                { ticker: 'HINDUNILVR', name: 'Hindustan Unilever', price: 2542.80, change: 0.34, pe: 58.90, forwardPe: 52.30, peg: 4.91, growth: 12.0, industry: 'Consumer Defensive', industryPe: 45.0 },
                { ticker: 'SBIN', name: 'State Bank of India', price: 628.50, change: 0.78, pe: 11.20, forwardPe: 9.80, peg: 0.70, growth: 16.0, industry: 'Financials', industryPe: 18.0 },
                { ticker: 'BHARTIARTL', name: 'Bharti Airtel', price: 1245.60, change: 1.45, pe: 75.80, forwardPe: 42.30, peg: 0.95, growth: 79.8, industry: 'Telecom', industryPe: 35.0 },
                { ticker: 'ITC', name: 'ITC Ltd.', price: 452.30, change: 0.23, pe: 28.40, forwardPe: 25.80, peg: 2.37, growth: 12.0, industry: 'Consumer Defensive', industryPe: 45.0 },
                { ticker: 'KOTAKBANK', name: 'Kotak Mahindra Bank', price: 1785.40, change: 0.56, pe: 22.80, forwardPe: 19.50, peg: 1.27, growth: 18.0, industry: 'Financials', industryPe: 18.0 }
            ]
        };

        // Exchange metadata
        const exchangeInfo = {
            nyse: { currency: '$', name: 'NYSE', country: 'USA', flag: 'ðŸ‡ºðŸ‡¸' },
            tsx: { currency: 'C$', name: 'TSX', country: 'Canada', flag: 'ðŸ‡¨ðŸ‡¦' },
            hkex: { currency: 'HK$', name: 'HKEX', country: 'Hong Kong', flag: 'ðŸ‡­ðŸ‡°' },
            sgx: { currency: 'S$', name: 'SGX', country: 'Singapore', flag: 'ðŸ‡¸ðŸ‡¬' },
            nse: { currency: 'â‚¹', name: 'NSE', country: 'India', flag: 'ðŸ‡®ðŸ‡³' }
        };

        // ============================================
        // STATE
        // ============================================
        let currentExchange = 'nyse';
        let currentFilter = 'all';
        let currentIndustry = 'all';
        let searchQuery = '';
        let currentPage = 1;
        let currentSort = 'ticker';
        const stocksPerPage = 12;

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function getValuation(peg) {
            if (peg < 1) return { label: 'UNDERVALUED', class: 'highlight-good', filter: 'undervalued' };
            if (peg <= 2) return { label: 'FAIR VALUE', class: 'highlight-warn', filter: 'fair' };
            return { label: 'OVERVALUED', class: 'highlight-bad', filter: 'overvalued' };
        }

        function getPeComparison(pe, industryPe) {
            const diff = ((pe - industryPe) / industryPe * 100).toFixed(0);
            if (diff < -5) return { text: `${diff}% vs IND`, class: 'highlight-good' };
            if (diff <= 10) return { text: `+${diff}% vs IND`, class: 'highlight-warn' };
            return { text: `+${diff}% vs IND`, class: 'highlight-bad' };
        }

        // ============================================
        // POWER SEARCH PARSER
        // ============================================
        function parseAdvancedSearch(query) {
            const result = {
                text: '',
                ticker: null,
                peMin: null,
                peMax: null,
                pegMin: null,
                pegMax: null,
                growthMin: null,
                growthMax: null,
                industry: null
            };

            // Split by pipe or space for multiple conditions
            const parts = query.split(/[\|\s]+/).filter(p => p.trim());

            parts.forEach(part => {
                const trimmed = part.trim().toLowerCase();

                // ticker:XYZ
                if (trimmed.startsWith('ticker:')) {
                    result.ticker = trimmed.replace('ticker:', '').toUpperCase();
                }
                // pe<20 or pe>10
                else if (trimmed.match(/^pe[<>]/)) {
                    const match = trimmed.match(/^pe([<>])(\d+\.?\d*)/);
                    if (match) {
                        if (match[1] === '<') result.peMax = parseFloat(match[2]);
                        else result.peMin = parseFloat(match[2]);
                    }
                }
                // peg<1 or peg>2
                else if (trimmed.match(/^peg[<>]/)) {
                    const match = trimmed.match(/^peg([<>])(\d+\.?\d*)/);
                    if (match) {
                        if (match[1] === '<') result.pegMax = parseFloat(match[2]);
                        else result.pegMin = parseFloat(match[2]);
                    }
                }
                // growth>15 or growth<30
                else if (trimmed.match(/^growth[<>]/)) {
                    const match = trimmed.match(/^growth([<>])(\d+\.?\d*)/);
                    if (match) {
                        if (match[1] === '<') result.growthMax = parseFloat(match[2]);
                        else result.growthMin = parseFloat(match[2]);
                    }
                }
                // industry:Tech
                else if (trimmed.startsWith('industry:')) {
                    result.industry = part.replace(/industry:/i, '');
                }
                // Regular text search
                else if (!trimmed.startsWith('sort:')) {
                    result.text += (result.text ? ' ' : '') + trimmed;
                }
            });

            return result;
        }

        function matchesAdvancedSearch(stock, criteria) {
            // Text search
            if (criteria.text && !stock.ticker.toLowerCase().includes(criteria.text) &&
                !stock.name.toLowerCase().includes(criteria.text)) {
                return false;
            }
            // Ticker exact match
            if (criteria.ticker && !stock.ticker.toUpperCase().includes(criteria.ticker)) {
                return false;
            }
            // PE filters
            if (criteria.peMin !== null && stock.pe < criteria.peMin) return false;
            if (criteria.peMax !== null && stock.pe > criteria.peMax) return false;
            // PEG filters
            if (criteria.pegMin !== null && stock.peg < criteria.pegMin) return false;
            if (criteria.pegMax !== null && stock.peg > criteria.pegMax) return false;
            // Growth filters
            if (criteria.growthMin !== null && stock.growth < criteria.growthMin) return false;
            if (criteria.growthMax !== null && stock.growth > criteria.growthMax) return false;
            // Industry filter
            if (criteria.industry && !stock.industry.toLowerCase().includes(criteria.industry.toLowerCase())) {
                return false;
            }
            return true;
        }

        // ============================================
        // SORTING FUNCTION
        // ============================================
        function sortStocks(stocks) {
            const sorted = [...stocks];
            switch (currentSort) {
                case 'ticker':
                    sorted.sort((a, b) => a.ticker.localeCompare(b.ticker));
                    break;
                case 'pe-asc':
                    sorted.sort((a, b) => a.pe - b.pe);
                    break;
                case 'pe-desc':
                    sorted.sort((a, b) => b.pe - a.pe);
                    break;
                case 'peg-asc':
                    sorted.sort((a, b) => a.peg - b.peg);
                    break;
                case 'peg-desc':
                    sorted.sort((a, b) => b.peg - a.peg);
                    break;
                case 'price-asc':
                    sorted.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    sorted.sort((a, b) => b.price - a.price);
                    break;
                case 'change-desc':
                    sorted.sort((a, b) => b.change - a.change);
                    break;
            }
            return sorted;
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        function renderStocks() {
            const stocks = stockData[currentExchange];
            const searchCriteria = parseAdvancedSearch(searchQuery);

            // Apply filters
            let filtered = stocks.filter(stock => {
                // Advanced search filter
                if (!matchesAdvancedSearch(stock, searchCriteria)) return false;

                // Valuation filter
                const valuation = getValuation(stock.peg);
                const matchesFilter = currentFilter === 'all' || valuation.filter === currentFilter;

                // Industry filter (from buttons)
                const matchesIndustry = currentIndustry === 'all' || stock.industry === currentIndustry;

                return matchesFilter && matchesIndustry;
            });

            // Apply sorting
            filtered = sortStocks(filtered);

            // Pagination
            const totalPages = Math.ceil(filtered.length / stocksPerPage);
            const start = (currentPage - 1) * stocksPerPage;
            const paginatedStocks = filtered.slice(start, start + stocksPerPage);

            // Update index display
            const endIdx = Math.min(start + stocksPerPage, filtered.length);
            document.getElementById('index-display').textContent =
                `IDX: ${String(start + 1).padStart(3, '0')}-${String(endIdx).padStart(3, '0')} / ${filtered.length}`;

            // Get exchange info
            const info = exchangeInfo[currentExchange];

            // Render stock cards
            const grid = document.getElementById('stock-grid');
            grid.innerHTML = paginatedStocks.map((stock, index) => {
                const valuation = getValuation(stock.peg);
                const peComparison = getPeComparison(stock.pe, stock.industryPe);
                const changeClass = stock.change >= 0 ? 'up' : 'down';
                const changeSign = stock.change >= 0 ? '+' : '';
                const globalIdx = String(start + index + 1).padStart(3, '0');

                return `
                    <div class="stock-card" data-rank="${globalIdx}">
                        <div class="card-header">
                            <div>
                                <div class="ticker">${stock.ticker}</div>
                                <div class="company-name">${stock.name}</div>
                            </div>
                            <div class="price-tag">
                                <div class="current-price">${info.currency}${stock.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                                <div class="price-change ${changeClass}">${changeSign}${stock.change.toFixed(2)}%</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="metric-row">
                                <span class="metric-label">P/E Ratio (TTM)</span>
                                <span class="metric-value ${peComparison.class}">${stock.pe.toFixed(2)}<span class="vs-industry">${peComparison.text}</span></span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Forward P/E</span>
                                <span class="metric-value">${stock.forwardPe.toFixed(2)}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">PEG Ratio</span>
                                <span class="metric-value ${valuation.class}">${stock.peg.toFixed(2)}<span class="vs-industry">${valuation.label}</span></span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">5Y EPS Growth</span>
                                <span class="metric-value">${stock.growth.toFixed(1)}%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Industry Avg P/E</span>
                                <span class="metric-value" style="color: rgba(240,240,232,0.5)">${stock.industryPe.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Render pagination
            renderPagination(totalPages, filtered.length);

            // Update stats
            document.getElementById('stock-count').textContent = filtered.length;
            document.getElementById('current-exchange').textContent = info.name;

            // Calculate total stocks across all exchanges
            const totalStocks = Object.values(stockData).reduce((sum, arr) => sum + arr.length, 0);
            document.getElementById('stats-line').textContent =
                `${filtered.length} stocks displayed // ${totalStocks} total // ${filtered.length * 5} metrics`;
        }

        function renderPagination(totalPages, totalStocks) {
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.innerHTML = `<span class="page-info">SHOWING ALL ${totalStocks} RESULTS</span>`;
                return;
            }

            let html = `<span class="page-info">PAGE ${currentPage} OF ${totalPages} // ${totalStocks} RESULTS</span>`;
            html += '<div class="page-btns">';

            if (currentPage > 1) {
                html += `<button class="page-btn" data-page="${currentPage - 1}">&lt; PREV</button>`;
            }

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += '<span class="page-dots">...</span>';
                }
            }

            if (currentPage < totalPages) {
                html += `<button class="page-btn" data-page="${currentPage + 1}">NEXT &gt;</button>`;
            }

            html += '</div>';
            pagination.innerHTML = html;

            // Add click handlers
            pagination.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentPage = parseInt(btn.dataset.page);
                    renderStocks();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentExchange = btn.dataset.exchange;
                currentPage = 1;
                renderStocks();
            });
        });

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                currentPage = 1;
                renderStocks();
            });
        });

        document.getElementById('stock-search').addEventListener('input', (e) => {
            searchQuery = e.target.value;
            currentPage = 1;
            renderStocks();
        });

        document.querySelectorAll('.industry-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.industry-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentIndustry = btn.dataset.industry;
                currentPage = 1;
                renderStocks();
            });
        });

        // Sort buttons
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentSort = btn.dataset.sort;
                currentPage = 1;
                renderStocks();
            });
        });

        // ============================================
        // KEYBOARD SHORTCUTS (Power User)
        // ============================================
        document.addEventListener('keydown', (e) => {
            // Ctrl+K - Focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('stock-search').focus();
            }
            // Ctrl+1-5 - Switch exchanges
            if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '5') {
                e.preventDefault();
                const exchanges = ['nyse', 'tsx', 'hkex', 'sgx', 'nse'];
                const idx = parseInt(e.key) - 1;
                if (idx < exchanges.length) {
                    currentExchange = exchanges[idx];
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector(`[data-exchange="${exchanges[idx]}"]`).classList.add('active');
                    currentPage = 1;
                    renderStocks();
                }
            }
            // Escape - Clear search
            if (e.key === 'Escape') {
                document.getElementById('stock-search').value = '';
                searchQuery = '';
                currentPage = 1;
                renderStocks();
                document.getElementById('stock-search').blur();
            }
        });

        // ============================================
        // TIMESTAMP
        // ============================================
        function updateTime() {
            const now = new Date();
            const options = {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            document.getElementById('timestamp').textContent = now.toLocaleDateString('en-US', options).toUpperCase();
        }
        updateTime();
        setInterval(updateTime, 1000);

        // ============================================
        // INITIALIZE
        // ============================================
        renderStocks();
    </script>
</body>
</html>

